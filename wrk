#!/bin/bash

ARGV="$@"

source ./scripts/-head -N "wrk" $@



unset OPTIND

while getopts "hcbdDCSJHI" flag; do

  case "${flag}" in
    h) HELP=1 ;;
    c) CLEAR_CONSOLE=1 ;;
    b) BUILD=1 ;;
    d) DEPLOY=1 ;;
    D) DEV=1 ;; # dev mode
  esac
done
shift $((OPTIND - 1))
TMPL_NAME=$1 # template name

if [ "$DEV" = "1" ]; then
  BUILD_OPTS="${BUILD_OPTS}D"
  BUILD_DIR="http/$TMPL_NAME"
else
  BUILD_OPTS=""
  BUILD_DIR="dist/$TMPL_NAME"
fi

TMPL_DIR="sites/${TMPL_NAME}"
DEPLOY_CONFIG="${TMPL_DIR}/deploy.json"

source scripts/wrk-actions

# -b (build)
if [ "$BUILD" = "1" ]; then
  npx tsx ./src/build.ts $ARGV
fi

# -d (deploy)
if [ "$DEPLOY" = "1" ]; then
  scripts/wrk-deploy $DEPLOY_CONFIG $BUILD_DIR $DEV
fi
